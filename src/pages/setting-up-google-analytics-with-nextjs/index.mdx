---
title: 'Setting Up Google Analytics with ‚ñ≤ Next.js'
summary: 'Building the structure for Google Analytics can be overwhelming sometimes. Even more with Next.js.'
publishedAt: '2021-01-16'
tags: [google, analytics, next.js, javascript]
ogTitle: '**Using Google Analytics with Next.js**'
---

Building the structure for [Google Analytics](https://analytics.google.com/) can be overwhelming sometimes. Even more
with [Next.js](https://nextjs.org/). I will try to explain how to implement it easily with the best practice approach.

Process will include these chapters:

- [Manage Analytics](#1-manage-analytics)
- [Call Necessary Functions on Route Change](#2-call-necessary-functions-on-route-change)
- [Add Google Analytics scripts to \__document.js_](#3-add-google-analytics-scripts-to-_documentjs)
- [Track Events](#4-track-events)

> I'm assuming that you have already setup your Google Analytics account and got your _Tracking ID_. See:
> [Get started with Analytics](https://support.google.com/analytics/answer/9306384?hl=en&ref_topic=9303319)

## 1. Manage Analytics

Let's create a helper file that we can manage our analytics code. This helper file will store your Google Analytics
Tracking ID and provide some methods that you need to track your page views and events. I will call it `analytics.js`.

```jsx:analytics.js
export const GA_TRACKING_ID = '<YOUR_GA_TRACKING_ID>'

// https://developers.google.com/analytics/devguides/collection/gtagjs/pages
export const trackPageView = (url) => {
  window.gtag('config', GA_TRACKING_ID, {
    page_path: url
  })
}

// https://developers.google.com/analytics/devguides/collection/gtagjs/events
export const trackEvent = ({ action, category, label, value }) => {
  window.gtag('event', action, {
    event_category: category,
    event_label: label,
    value
  })
}
```

## 2. Call Necessary Functions on Route Change

We will call the event functions that we created in `analytics.js` when the router detects route is changed.

```jsx:_app.js
import { useEffect, useState } from 'react'
import { useRouter } from 'next/router'

import { trackPageView } from '../analytics'

function App({ Component, pageProps }) {
  const router = useRouter()

  useEffect(() => {
    const handleRouteChange = (url) => {
      trackPageView(url)
    }
    router.events.on('routeChangeComplete', handleRouteChange)
    return () => {
      router.events.off('routeChangeComplete', handleRouteChange)
    }
  }, [router.events])

  return <Component {...pageProps} />
}

export default App
```

## 3. Add Google Analytics scripts to \__document.js_

Either create a custom `_document.js` file or update existing one. Also, we will be only loading the scripts in
**production** to make sure that we don‚Äôt track events locally. To achieve that we will use
`process.env.NODE_ENV === 'production'` condition.

```jsx:_document.js
import Document, { Html, Head, Main, NextScript } from 'next/document'

import { GA_TRACKING_ID } from '../analytics'

export default class MyDocument extends Document {
  render() {
    return (
      <Html>
        <Head>
          {/* Call only on production */}
          {process.env.NODE_ENV === 'production' && (
            <>
              <script async src={`https://www.googletagmanager.com/gtag/js?id=${GA_TRACKING_ID}`} />
              <script
                dangerouslySetInnerHTML={{
                  __html: `
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){dataLayer.push(arguments);}
                    gtag('js', new Date());
                    gtag('config', '${GA_TRACKING_ID}');
                  `
                }}
              />
            </>
          )}
        </Head>
        <body>
          <Main />
          <NextScript />
        </body>
      </Html>
    )
  }
}
```

## 4. Track Events

```jsx
import { trackEvent } from '../analytics'

...
...

trackEvent({
  action: 'submit_form',
  category: 'Contact',
  label: this.state.message,
})
```

Hope this helps you. üëãüèº

### References

- [Next.js Google Analytics Example](https://github.com/zeit/next.js/tree/canary/examples/with-google-analytics)
